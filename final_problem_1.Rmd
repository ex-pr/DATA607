---
title: "Problem 1 Final"
author: "Daria Dubovskaia"
output:
  html_document:
    toc: true
    toc_depth: 6
---


```{r setup, include=FALSE, results='hide', warning=FALSE, message=FALSE}
library(tidyverse)
library(imager)
library(reticulate)
library(matrixcalc)
library(igraph)
```


### 1. Final, Problem 1. 30 Points. Playing with PageRank
You’ll verify for yourself that PageRank works by performing calculations on a small universe of web pages. Let’s use the 6 page universe that we had in the previous discussion For this directed graph, perform the following calculations in R.

#### 1.1 Form the A matrix. Then, introduce decay and form the B matrix as we did in the course notes. (5 Points)
Matrix A from the notes:
```{r}
A <- matrix(c(0, 1/2, 1/2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1/3, 1/3, 0, 0, 1/3, 0, 0, 0, 0, 0, 1/2, 1/2, 0, 0, 0, 1/2, 0, 1/2, 0, 0, 0, 1, 0, 0), nrow = 6, byrow = TRUE)
A
```

The second row should be filled with 1/6 instead of 0s as we are building the matrix for the the 6 page universe:
```{r}
ri <- matrix(c(1/6, 1/6, 1/6, 1/6, 1/6, 1/6),ncol=6)
A[2,]<-ri
A

```
$$ A=
\begin{bmatrix}
0 & 1/2 & 1/2 & 0 & 0 & 0 \\
1/6 & 1/6 & 1/6 & 1/6 & 1/6 & 1/6  \\
1/3 & 1/3 & 0 & 0 & 1/3 & 0 \\
0& 0& 0& 0& 1/2& 1/2 \\
0& 0& 0& 1/2& 0&1/2 \\
0& 0& 0& 1& 0& 0
\end{bmatrix}$$


A new matrix B which is a decayed version of the original matrix A:
$$B=0.85\cdot A + \frac{1-d}{n}$$

In the classic version by Page and Brin, the decay and n (size of matrix A) is:
$$d=0.85, n=6$$


```{r}
decay=0.85
n <- nrow(A)
B <- decay * A + (1-decay)/n
B 
```

$$ B =
\begin{bmatrix}
0.025 & 0.45 & 0.45 & 0.025 & 0.025 & 0.025 \\
0.167 & 0.167 & 0.167 & 0.167 & 0.167 & 0.167  \\
0.308 & 0.308 & 0.025 & 0.025 & 0.308 & 0.025 \\
0.025 & 0.025 & 0.025 & 0.025 & 0.45 & 0.45 \\
0.025 & 0.025 & 0.025 & 0.45 & 0.025 & 0.45 \\
0.025 & 0.025 & 0.025 & 0.875 & 0.025 & 0.025
\end{bmatrix} $$

#### 1.2 Start with a uniform rank vector r and perform power iterations on B till convergence. That is, compute the solution r = B_n × r. Attemptthis for a sufficiently large n so that r actually converges. (5 Points)
The convergence happens at the interation=30.
```{r}
r_i <- rep(1/6, 6)

n <- 0
iter_0  <- matrix.power(t(B), n) %*%  r_i
iter_0 
```

```{r}
n <- 10
iter_10 <- matrix.power(t(B), n) %*%  r_i
iter_10 
```
```{r}
n <- 20
iter_20 <- matrix.power(t(B), n) %*%  r_i
iter_20
```
```{r}
n <- 30
r_converge <- matrix.power(t(B), n) %*%  r_i
r_converge
```

```{r}
n <- 40
iter_40 <- matrix.power(t(B), n) %*%  r_i
iter_40
```


#### 1.3 Compute the eigen-decomposition of B and verify that you indeed get an eigenvalue of 1 as the largest eigenvalue and that its corresponding eigenvector is the same vector that you obtained in the previous power iteration method. Further, this eigenvector has all positive entries and it sums to 1.
The eigen-decomposition of B:
```{r}
eigen_b <- eigen(B) 
eigen_b 
```

The eigenvalue of 1 is the largest eigenvalue:
```{r}
max_val <- which.max(eigen_b$values)
max_val
```
The eigenvector has all positive entries and it sums to 1:
```{r}
pagerank_2 <- eig_b$vectors[,1]/sum(eig_b$vectors[,1])
sum(pagerank_2)
```

#### 1.4 Use the graph package in R and its page.rank method to compute the Page Rank of the graph as given in A. Note that you don’t need to apply decay. The package starts with a connected graph and applies decay internally. Verify that you do get the same PageRank vector as the two approaches above.
We got the same results from the plot:
```{r}
graph <- graph_from_adjacency_matrix(A, weighted = T)
plot(graph)

Rank <- page.rank(graph)$vector

as.matrix(Rank)
results <- (round(r_converge, 4) == round(Rank, 4))
results
```